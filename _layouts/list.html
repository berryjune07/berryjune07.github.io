---
# Copyright (c) 2018 Florian Klampfer <https://qwtel.com/>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

layout: page
---

{{ content }}

{% assign posts = site.categories[page.slug] | default:site.tags[page.slug] | default:site.posts %}
{% unless posts %}
  {% assign posts = "" | split: "" %}
{% endunless %}

{% if page.type == 'category' %}
  {% assign featured_category_tags = site.featured_tags | where:"category", page.slug %}
  {% assign featured_tag_slugs = featured_category_tags | map:"slug" %}
  {% assign category_tags_from_posts = posts | map:"tags" | join:"," | split:"," | uniq | sort | where_exp:"tag","tag != ''" %}
  {% assign category_tag_slugs = category_tags_from_posts | concat:featured_tag_slugs | uniq | sort %}
  {% assign category_post_count = posts | size %}

  <div class="category-meta">
    <span class="category-meta__count">{{ category_post_count }} post{% unless category_post_count == 1 %}s{% endunless %}</span>
  </div>

  {% if category_tag_slugs.size > 0 %}
    <div class="category-tag-cloud">
      <div class="category-tag-cloud__title">Subtags</div>
      <div class="category-tag-cloud__list">
        {% for tag_slug in category_tag_slugs %}
          {% assign tag_meta = site.featured_tags | where:"slug", tag_slug | first %}
          {% assign tag_slugified = tag_slug | strip | slugify %}
          {% assign tag_title = tag_meta.title %}
          {% unless tag_title %}
            {% assign tag_words = tag_slugified | replace:'-',' ' | split:' ' %}
            {% capture tag_title %}
              {% for word in tag_words %}
                {% assign cap_word = word | capitalize %}
                {{ cap_word }}{% unless forloop.last %} {% endunless %}
              {% endfor %}
            {% endcapture %}
            {% assign tag_title = tag_title | strip %}
          {% endunless %}
          {% assign tag_url = tag_meta.url %}
          {% unless tag_url %}
            {% assign tag_url = '/tag-' | append:tag_slugified | append:'/' %}
          {% endunless %}
          {% assign tag_posts = site.tags[tag_slugified] %}
          {% assign tag_post_count = 0 %}
          {% if tag_posts %}
            {% assign tag_post_count = tag_posts | size %}
          {% endif %}
          {% assign tag_item_classes = 'category-tag-cloud__item' %}
          {% if tag_post_count == 0 %}
            {% assign tag_item_classes = tag_item_classes | append:' category-tag-cloud__item--empty' %}
          {% endif %}
          <a class="{{ tag_item_classes }}" href="{{ tag_url | relative_url }}">
            <span class="category-tag-cloud__name">{{ tag_title }}</span>
            <span class="category-tag-cloud__badge">{{ tag_post_count }}</span>
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endif %}

{% assign date_formats  = site.data.strings.date_formats               %}
{% assign list_group_by = date_formats.list_group_by | default:"%Y"    %}
{% assign list_entry    = date_formats.list_entry    | default:"%d %b" %}

{% assign posts_latest = posts | sort: "date" | reverse %}
{% assign posts_oldest = posts | sort: "date" %}

<div class="post-sort-controls" role="group" aria-label="Sort posts">
  <button type="button" class="post-sort-button is-active" data-sort="latest" aria-label="Sort by latest">
    <span class="post-sort-icon fa-solid fa-arrow-down-short-wide" aria-hidden="true"></span>
    <span class="sr-only">Latest</span>
  </button>
  <button type="button" class="post-sort-button" data-sort="oldest" aria-label="Sort by oldest">
    <span class="post-sort-icon fa-solid fa-arrow-up-wide-short" aria-hidden="true"></span>
    <span class="sr-only">Oldest</span>
  </button>
</div>

<div class="post-sort-list is-active" data-sort-list="latest">
  {% include_cached components/post-list-grouped.html posts=posts_latest list_group_by=list_group_by list_entry=list_entry heading_class="hr-bottom" no_groups=page.no_groups %}
</div>

<div class="post-sort-list" data-sort-list="oldest">
  {% include_cached components/post-list-grouped.html posts=posts_oldest list_group_by=list_group_by list_entry=list_entry heading_class="hr-bottom" no_groups=page.no_groups %}
</div>

<script>
(function() {
  var controls = document.querySelector('.post-sort-controls');
  if (!controls) return;
  var buttons = controls.querySelectorAll('.post-sort-button');
  var lists = document.querySelectorAll('.post-sort-list');
  controls.addEventListener('click', function (event) {
    var btn = event.target.closest('.post-sort-button');
    if (!btn) return;
    var sort = btn.getAttribute('data-sort');
    buttons.forEach(function (button) {
      button.classList.toggle('is-active', button === btn);
    });
    lists.forEach(function (list) {
      list.classList.toggle('is-active', list.getAttribute('data-sort-list') === sort);
    });
  });
})();
</script>