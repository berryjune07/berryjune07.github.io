<!DOCTYPE html>
<html lang="en">







<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  






  
    
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Mo’s Algorithm | Jiho’s Blog</title>
<meta name="generator" content="Jekyll v3.9.2">
<meta property="og:title" content="Mo’s Algorithm">
<meta name="author" content="Jiho Jun">
<meta property="og:locale" content="en">
<meta name="description" content="noting down my thoughts and experiences">
<meta property="og:description" content="noting down my thoughts and experiences">
<link rel="canonical" href="http://localhost:4000/computer-science/mos-algorithm.html">
<meta property="og:url" content="http://localhost:4000/computer-science/mos-algorithm.html">
<meta property="og:site_name" content="Jiho’s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-11-12T00:00:00+09:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Mo’s Algorithm">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jiho Jun"},"dateModified":"2025-11-12T00:00:00+09:00","datePublished":"2025-11-12T00:00:00+09:00","description":"noting down my thoughts and experiences","headline":"Mo’s Algorithm","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/computer-science/mos-algorithm.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/berry.jpg"},"name":"Jiho Jun"},"url":"http://localhost:4000/computer-science/mos-algorithm.html"}</script>
<!-- End Jekyll SEO tag -->


  

  
    <meta name="keywords" content="Development,C++,Rust,Jekyll">
  



  <meta name="theme-color" content="rgb(31,55,75)">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Jiho's Blog">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="Jiho's Blog">

<meta name="generator" content="Hydejack v9.1.6">



<link rel="alternate" href="http://localhost:4000/computer-science/mos-algorithm.html" hreflang="en">

<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Jiho's Blog">


<link rel="shortcut icon" href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">

<link rel="manifest" href="/assets/site.webmanifest">

<link rel="dns-prefetch" href="https://fonts.googleapis.com">
<link rel="dns-prefetch" href="https://fonts.gstatic.com">


  <link rel="dns-prefetch" href="https://www.google-analytics.com">


<link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">

  <link rel="dns-prefetch" href="/assets/js/search-worker-9.1.6.js" as="worker" id="_hrefSearch">





  <link rel="stylesheet" href="https://unpkg.com/applause-button/dist/applause-button.css">
  <script src="https://unpkg.com/applause-button/dist/applause-button.js"></script>


<!-- For sidebar folder -->
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">


  <link rel="stylesheet" href="/assets/css/lightbox.css">



<!-- Global site tag (gtag.js) - Google Analytics -->
<script defer src="https://www.googletagmanager.com/gtag/js?id=G-VMBTN8BX5P"></script>
<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}

        gtag('js', new Date());
        gtag('config', 'G-VMBTN8BX5P');
    });
</script>

<script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script"),e=(n.src=e,t&&a(n,"load",t,{once:!0}),c.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/';
  w._publicPath = '/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = false;
  w._noToc = false;
  w._noSearch = false;
  w._advertise = false;
  w._search = {
    DATA_URL: '/assets/sitedata.json?no-cache',
    STORAGE_KEY: 'mini-search/',
    INDEX_KEY: 'index--2025-12-03T23:28:18+09:00',
  };
}(window);</script>

<!-- font awesome -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css">

<!-- KATEX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/copy-tex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/mhchem.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/mathtex-script-type.min.js"></script>

<script src="/assets/js/katex.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    render_KaTeX();
  });
</script>

<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/assets/css/hydejack-9.1.6.css" id="_stylePreload">
<link rel="stylesheet" href="/assets/icomoon/style.css" id="_iconsPreload">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans+KR%7CJetBrains+Mono%7CNanum+Gothic+Coding&amp;display=swap" id="_fontsPreload">




<!--<![endif]-->





</head>

<body class="no-break-layout no-large-headings">
  
<script>
  window._sunrise = 6;
  window._sunset =  18;
  !function(e,s){var d="light-mode",o="dark-mode",a=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(e=(a=a<=e._sunrise||a>=e._sunset?o:d)==o?d:o,s.body.classList.add(a),s.body.classList.remove(e))}(window,document);

</script>



<hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange>
  
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden>

  <main id="_main" class="content layout-post" role="main">
  <nav id="breadcrumbs" class="screen-only"><ul>
  
  
    <li><a href="/">home</a></li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/computer-science/">computer-science</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          <span>mos-algorithm.html</span>
        
      </li>
    
  
</ul></nav>

  










<article id="post-computer-science-mos-algorithm" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        Mo's Algorithm
        
      
    </h1>

    <div class="post-date">
      
      <span class="ellipsis mr1">
        <time datetime="2025-11-12T00:00:00+09:00">12 Nov 2025</time> in <a href="/computer-science/" class="flip-title">Computer Science</a> on <a href="/tag-algorithms/" class="flip-title">Algorithms</a>
      </span>
      
        
      

      <span class="additional-info" style="font-size:1rem">
          <!--
        <span class="page-pv">
          <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=http://localhost:4000/computer-science/mos-algorithm.html&count_bg=%23000000&title_bg=%23000000&icon=openstreetmap.svg&icon_color=%23E7E7E7&title=Views&edge_flat=false"/>
        </span>
          -->
        ·
        <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->








<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="915 words">
  <i class="fa-regular fa-hourglass-half"></i>
   15 min
</span>

      </span>
    </div>

    
    

    



  <div class="hr pb0"></div>


  </header>

  
    <!--more-->
<ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#explanation" id="markdown-toc-explanation">Explanation</a></li>
  <li><a href="#complexity" id="markdown-toc-complexity">Complexity</a></li>
  <li>
<a href="#code" id="markdown-toc-code">Code</a>    <ul>
      <li><a href="#example" id="markdown-toc-example">Example</a></li>
    </ul>
  </li>
</ul>

<h2 id="introduction">Introduction</h2>

<p><strong>Mo’s Algorithm</strong> is an offline algorithm optimization technique to answer multiple range queries on a static array.
It employs an idea from the <strong><a href="/computer-science/sqrt-decomposition.html">sqrt-decomposition</a></strong> technique, 
enabling us to answer each query averagely in $O\left( \sqrt{N} \right)$ time.</p>

<h2 id="explanation">Explanation</h2>

<p>Mo’s Algorithm can handle multiple range queries on a static array sorting the queries.
The queries should be able to be computed by adding or removing elements from the current range so that 
we can move the start and end pointers of the range to answer each query. We here use an idea from
the sqrt-decomposition technique; dividing the array into blocks of size approximately $\sqrt{N}$, and sorting the queries
first by the block of their start position, and then by their end position.</p>

<p>Mathematically speaking, we can answer a query $F([l,r])=F_s(f([l,r]))$ for an array $A=[a_1,\cdots,a_N]$ of size $N$ if $f$ satisfies the following properties:</p>
<ul>
  <li>$f([l,r+1]) = U_{\rm r}(f([l,r]), a_{r+1})$</li>
  <li>$f([l,r-1]) = D_{\rm r}(f([l,r]), a_r)$</li>
  <li>$f([l-1,r]) = U_{\rm l}(f([l,r]), a_{l-1})$</li>
  <li>$f([l+1,r]) = D_{\rm l}(f([l,r]), a_l)$</li>
</ul>

<p>where $U_{\rm r}$ and $D_{\rm r}$ are right adding and removing functions, $U_{\rm l}$ and $D_{\rm l}$ are left adding and removing functions respectively.
$f$ is a function that maps an range $[l,r]$ to a latent result, and $F_s$ is a function that maps the latent result to the final answer.
The functions should satisfy the following properties:</p>
<ul>
  <li>$D_{\rm r}(U_{\rm r}(f([l,r]), a_{r+1}), a_{r+1}) = U_{\rm r}(D_{\rm r}(f([l,r]), a_r), a_r) = f([l,r])$</li>
  <li>$D_{\rm l}(U_{\rm l}(f([l,r]), a_{l-1}), a_{l-1}) = U_{\rm l}(D_{\rm l}(f([l,r]), a_l), a_l) = f([l,r])$</li>
</ul>

<p>In other words, for all $x$,</p>
<ul>
  <li>$U_{\rm r}(\cdot,x) = (D_{\rm r}(\cdot,x))^{-1}$</li>
  <li>$U_{\rm l}(\cdot,x) = (D_{\rm l}(\cdot,x))^{-1}$</li>
</ul>

<p>This means, after computing $f([l_1,r_1])$, we can compute $f([l_2,r_2])$ by applying
$U_{\rm l}$ or $D_{\rm l}$ $\abs{l_2-l_1}$ times and $U_{\rm r}$ or $D_{\rm r}$ $\abs{r_2-r_1}$ times.
For the whole set of $Q$ queries, we should minimize the sum of the shifts:</p>

<p>\[
\sum_{q=1}^{Q-1} \abs{l_q-l_{q+1}} + \abs{r_q-r_{q+1}}
\]</p>

<p>and this can be done by a “proper” sorting of the queries explained above.</p>

<p>\[
(l_1,r_1) &lt; (l_2,r_2) \;\Leftrightarrow\; \begin{cases}
\dps \left\lfloor \frac{l_1}{B} \right\rfloor &lt; \left\lfloor \frac{l_2}{B} \right\rfloor &amp;\nl
r_1 &lt; r_2 &amp; \text{if } \dps \left\lfloor \frac{l_1}{B} \right\rfloor = \left\lfloor \frac{l_2}{B} \right\rfloor
\end{cases}
\]</p>

<p>where $B = \left\lceil \sqrt{N} \right\rceil$ is the block size.
Let’s look at an example. For the following range queries,</p>

<p>\[
\Set{(4,6),(5,9),(2,7),(3,4)}
\]</p>

<p>we process them in the following order:</p>

<pre><code class="language-mermaid">graph LR
    subgraph A["Block 1"]
        direction LR;
        A1((1)); A2((2)); A3((3));
    end
    subgraph B["Block 2"]
        direction LR;
        B1((4)); B2((5)); B3((6));
    end
    subgraph C["Block 3"]
        direction LR;
        C1((7)); C2((8)); C3((9));
    end
    A1 --- A2 --- A3 --- B1 --- B2 --- B3 --- C1 --- C2 --- C3;
    A3 --&gt; A2 --&gt; B1 --&gt; B2;
    B1 -.-&gt; C1 -.-&gt; B3 -.-&gt; C3;
    linkStyle 0,1,2,3,4,5,6,7 stroke:transparent;
    A2:::q1; C1:::q1;
    A3:::q2; B1:::q2;
    B3:::q3;
    B2:::q4; C3:::q4;
    classDef q1 fill:#bbf,stroke:#333,stroke-width:2px;
    classDef q2 fill:#9bf,stroke:#333,stroke-width:2px;
    classDef q3 fill:#fdb,stroke:#333,stroke-width:2px;
    classDef q4 fill:#faa,stroke:#333,stroke-width:2px;
</code></pre>

<p>The solid lines are the shift of left pointers, and the dotted lines are the shift of right pointers.
Though it is not the global optimal minimum of the shifts, this method gives enough time complexity to handle lots of queries.</p>

<h2 id="complexity">Complexity</h2>

<p>Denote $S(N)$ as the time complexity to shift the pointers by one position ($U_{\rm l}$, $D_{\rm l}$, $U_{\rm r}$, $D_{\rm r}$),
$T(N)$ as the time complexity to compute $F_s$ from the latent result.</p>

<p>⁣1. Sorting the queries: $O(Q \log Q)$</p>

<p>⁣2. Shifting the pointers: $O\left((N + Q) \sqrt{N} S(N)\right)$</p>

<p>Let’s think of two cases: when successive queries have their start positions in the same block, and when they are in different blocks.
When they are in the same block, the left pointer shifts at most $B$ times, and the right pointer shifts at most $N$ times in total for all such queries since they are monotonically increasing.
Thus, the total shift number is $O\left( BQ + N \cdot \frac{N}{B} \right) = O\left( (N+Q) \sqrt{N} \right)$.
When they are in different blocks, the left and right pointers shift at most $N$ times each.
This case only occurs $O\left( \frac{N}{B} \right)$ times, so the total shift number is $O\left( N \cdot \frac{N}{B} \right) = O\left( N \sqrt{N} \right)$.
Therefore, the overall time complexity is $O\left( (N+Q) \sqrt{N} S(N) \right)$.</p>

<p>⁣3. Computing answers: $O(Q T(N))$</p>

<p>Thus, the overall time complexity is:</p>

<p>\[
O\left( Q\log Q + (N+Q) \sqrt{N} S(N) + Q T(N) \right)
\]</p>

<p>We usually use Mo’s Algorithm for problems with $S(N) \approx O(1), T(N) \le O\left( \sqrt{N} \right)$
so that the overall time complexity becomes:</p>

<p>\[
O\left( (N+Q) \sqrt{N} \right)
\]</p>

<h2 id="code">Code</h2>

<p>Let’s see the sample code.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">int</span> <span class="n">N</span><span class="p">,</span><span class="n">Q</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">B</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">));</span> <span class="c1">// block size</span>

<span class="k">struct</span> <span class="nc">Query</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">idx</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span><span class="o">&amp;</span> <span class="n">q</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="n">B</span> <span class="o">!=</span> <span class="n">q</span><span class="p">.</span><span class="n">l</span><span class="o">/</span><span class="n">B</span><span class="p">)</span> <span class="k">return</span> <span class="n">l</span><span class="o">/</span><span class="n">B</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">.</span><span class="n">l</span><span class="o">/</span><span class="n">B</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">query</span><span class="p">[</span><span class="n">Q</span><span class="p">];</span>
<span class="n">q</span> <span class="n">ans</span><span class="p">[</span><span class="n">Q</span><span class="p">];</span>
<span class="n">data</span> <span class="n">A</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="n">latent</span> <span class="n">f</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">bool</span> <span class="n">dir</span><span class="p">);</span> <span class="c1">// add A[x] to the current range if(dir) right, else left, and update f</span>
<span class="kt">void</span> <span class="nf">Remove</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">bool</span> <span class="n">dir</span><span class="p">);</span> <span class="c1">// remove A[x] from the current range if(dir) right, else left, and update f</span>
<span class="n">q</span> <span class="nf">GetAnswer</span><span class="p">();</span> <span class="c1">// compute the final answer from f</span>

<span class="kt">void</span> <span class="nf">Mo</span><span class="p">(){</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">query</span><span class="o">+</span><span class="n">Q</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">idx</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">l</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">r</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">Addr</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="n">ans</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">GetAnswer</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">Q</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">ql</span><span class="o">=</span><span class="n">query</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">qr</span><span class="o">=</span><span class="n">query</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idx</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">ql</span><span class="o">&lt;</span><span class="n">l</span><span class="p">)</span> <span class="n">Add</span><span class="p">(</span><span class="o">--</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">r</span><span class="o">&lt;</span><span class="n">qr</span><span class="p">)</span> <span class="n">Add</span><span class="p">(</span><span class="o">++</span><span class="n">r</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">l</span><span class="o">&lt;</span><span class="n">ql</span><span class="p">)</span> <span class="n">Remove</span><span class="p">(</span><span class="n">l</span><span class="o">++</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="n">qr</span><span class="o">&lt;</span><span class="n">r</span><span class="p">)</span> <span class="n">Remove</span><span class="p">(</span><span class="n">r</span><span class="o">--</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">GetAnswer</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="example">Example</h3>

<p>Consider counting the number of distinct elements in a range.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">int</span> <span class="n">RANGE</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">A</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">cnt</span><span class="p">[</span><span class="n">RANGE</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">Q</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">distinct</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cnt</span><span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="n">x</span><span class="p">]])</span> <span class="n">distinct</span><span class="o">++</span><span class="p">;</span> <span class="n">cnt</span><span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">void</span> <span class="nf">Remove</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span> <span class="n">cnt</span><span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span><span class="o">--</span><span class="p">;</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cnt</span><span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="n">x</span><span class="p">]])</span> <span class="n">distinct</span><span class="o">--</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">int</span> <span class="nf">GetAnswer</span><span class="p">(){</span> <span class="k">return</span> <span class="n">distinct</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

  
</article>



<applause-button class="mb6" color="rgb(0,174,239)" url="http://localhost:4000/computer-science/mos-algorithm.html">
  </applause-button>






  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    


<img src="/assets/img/piano.png" alt="Jiho Jun" class="avatar" width="120" height="120" loading="lazy">

  

  
  
  <h2 class="page-title hr-bottom">
    About
  </h2>

  <p>Hello. <br>
Please check my <a href="/resume/">Resume</a> to find out more about me!<br></p>



  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      




    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/phylosopher07" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      




    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:pianoforte0203@gmail.com" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://facebook.com/100078342350761" title="Facebook" class="no-mark-external">
      <span class="icon-facebook"></span>
      <span class="sr-only">Facebook</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>

  </aside>


  

  
    


  

  
    


                                                <!--<aside class="other-projects related mb0" role="complementary">  <h2>Related Posts</h2>  <div class="columns">          <div class="column column-1-2">                  <article class="project-card">  <a href="/computer-science/topological-sorting.html" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine fallback-img">          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/computer-science/topological-sorting.html" class="flip-title">Topological Sorting</a>  </h3>      <a class="fill-card no-hover" href="/computer-science/topological-sorting.html" tabindex="-1"><span class="sr-only">Continue reading Topological Sorting</span></a></article>              </div>          <div class="column column-1-2">                  <article class="project-card">  <a href="/computer-science/euler-tour-technique.html" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine fallback-img">          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/computer-science/euler-tour-technique.html" class="flip-title">Euler Tour Technique</a>  </h3>      <a class="fill-card no-hover" href="/computer-science/euler-tour-technique.html" tabindex="-1"><span class="sr-only">Continue reading Euler Tour Technique</span></a></article>              </div>      </div></aside>--><aside class="related mb4" role="complementary">  <h2 class="hr-bottom">Related Posts</h2>  <ul class="related-posts">          <li class="h4">  <a href="/computer-science/topological-sorting.html" class="flip-title">    <span>            Topological Sorting    </span>  </a>      <time class="faded fine" datetime="2025-11-27T00:00:00+09:00">      27 Nov 2025    </time>        <span class="clap-count" data-url="http://localhost:4000/computer-science/topological-sorting.html"></span>  </li>          <li class="h4">  <a href="/computer-science/euler-tour-technique.html" class="flip-title">    <span>            Euler Tour Technique    </span>  </a>      <time class="faded fine" datetime="2025-11-26T00:00:00+09:00">      26 Nov 2025    </time>        <span class="clap-count" data-url="http://localhost:4000/computer-science/euler-tour-technique.html"></span>  </li>          <li class="h4">  <a href="/computer-science/merge-sort-tree.html" class="flip-title">    <span>            Merge Sort Tree    </span>  </a>      <time class="faded fine" datetime="2025-11-12T00:00:00+09:00">      12 Nov 2025    </time>        <span class="clap-count" data-url="http://localhost:4000/computer-science/merge-sort-tree.html"></span>  </li>          <li class="h4">  <a href="/computer-science/sqrt-decomposition.html" class="flip-title">    <span>            Sqrt Decomposition    </span>  </a>      <time class="faded fine" datetime="2025-11-11T00:00:00+09:00">      11 Nov 2025    </time>        <span class="clap-count" data-url="http://localhost:4000/computer-science/sqrt-decomposition.html"></span>  </li>      </ul></aside>

  

  
    
<aside class="comments related" role="complementary">
  <h2 class="hr-bottom">Comments</h2>
  

  
  
    <!--
    <script type="text/javascript">
      $(function () {
        const origin = "https://giscus.app";
        const iframe = "iframe.giscus-frame";
        const lightTheme = "light";
        const darkTheme = "dark_dimmed";

        let giscusAttributes = {
          "src": "https://giscus.app/client.js",
          "data-repo": "berryjune07/berryjune07.github.io",
          "data-repo-id": "",
          "data-category": "General",
          "data-category-id": "",
          "data-mapping": "pathname",
          "data-strict": "0",
          "data-reactions-enabled": "",
          "data-emit-metadata": "0",
          "data-input-position": "",
          "data-theme": "light",
          "data-lang": "en",
          "data-loading": "lazy",
          "crossorigin": "anonymous",
          "async": ""
        };
        let giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
        document.getElementById("tail-wrapper").appendChild(giscusScript);
        addEventListener("message", (event) => {
          if (event.source === window && event.data &&
                  event.data.direction === ModeToggle.ID) {
            /* global theme mode changed */
            const mode = event.data.message;
            const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme);
            const message = {
              setConfig: {
                theme: theme
              }
            };
            const giscus = document.querySelector(iframe).contentWindow;
            giscus.postMessage({ giscus: message }, origin);
          }
        });
      });
    </script>
    -->

    <script src="https://giscus.app/client.js" data-repo="berryjune07/berryjune07.github.io" data-repo-id="" data-category="General" data-category-id="" data-mapping="pathname" data-strict="0" data-reactions-enabled="" data-emit-metadata="0" data-input-position="" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async>
    </script>
  


</aside>


  

  
<footer class="content" role="contentinfo">
  <hr>
  
    <p><small class="copyright">© 2023. All rights reserved.
</small></p>
  
  
    <nav class="legal"><small>
    
      
      <a class="heading flip-title" href="/licenses/">LICENSES</a>
      |
    
      
      <a class="heading flip-title" href="/cookies-policy/">COOKIES POLICY</a>
      
    
    </small></nav>
  
  
  <hr class="sr-only">
</footer>


</main>

  <hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll>
  <header id="_sidebar" class="sidebar" role="banner">
    




<div class="sidebar-bg " style="background:center / cover url(/assets/img/note.jpg)"></div>

    <div class="sidebar-sticky no-fouc">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/" tabindex="-1">
        <img src="/assets/img/berry.jpg" class="avatar" alt="Jiho's Blog" width="120" height="120" loading="lazy">
      </a>
    
    <a class="sidebar-title" href="/"><h2 class="h1">Jiho's Blog</h2></a>
    
    
      <p class="">
        <em>Appassionato</em>

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
        
        
        <li>
          
          <div class="list-wrapper">
            <a href="/about/" class="sidebar-nav-item">About</a>
            
          </div>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
            <input type="checkbox" id="folder-checkbox-10">
          
          <div class="list-wrapper">
            <a href="/mathematics/" class="sidebar-nav-item">Mathematics</a>
            
              <button class="spread-btn" onclick="javascript:spread(10)">
                <label id="spread-icon-10" class="material-icons">arrow_right</label>
              </button>
            
          </div>
          
            <ul class="list-body">
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-statistics/">Statistics</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-number-theory/">Number Theory</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-linear-algebra/">Linear Algebra</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-calculus/">Calculus</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-topology/">Topology</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-differential-geometry/">Differential Geometry</a>
                </li>
            </ul>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
            <input type="checkbox" id="folder-checkbox-11">
          
          <div class="list-wrapper">
            <a href="/physics/" class="sidebar-nav-item">Physics</a>
            
              <button class="spread-btn" onclick="javascript:spread(11)">
                <label id="spread-icon-11" class="material-icons">arrow_right</label>
              </button>
            
          </div>
          
            <ul class="list-body">
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-classical-electromagnetism/">Classical Electromagnetism</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-quantum-mechanics/">Quantum Mechanics</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-fluid-mechanics/">Fluid Mechanics</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-classical-mechanics/">Classical Mechanics</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-elementary-physics/">Elementary Physics</a>
                </li>
            </ul>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
            <input type="checkbox" id="folder-checkbox-12">
          
          <div class="list-wrapper">
            <a href="/computer-science/" class="sidebar-nav-item">Computer Science</a>
            
              <button class="spread-btn" onclick="javascript:spread(12)">
                <label id="spread-icon-12" class="material-icons">arrow_right</label>
              </button>
            
          </div>
          
            <ul class="list-body">
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-problem-solving/">Problem Solving</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-algorithms/">Algorithms</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-artificial-intelligence/">Artificial Intelligence</a>
                </li>
            </ul>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
            <input type="checkbox" id="folder-checkbox-13">
          
          <div class="list-wrapper">
            <a href="/classical-music/" class="sidebar-nav-item">Classical Music</a>
            
              <button class="spread-btn" onclick="javascript:spread(13)">
                <label id="spread-icon-13" class="material-icons">arrow_right</label>
              </button>
            
          </div>
          
            <ul class="list-body">
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-ravel/">Ravel</a>
                </li>
            
          
            
                <li>
                  <a class="sidebar-nav-subitem" href="/tag-rachmaninoff/">Rachmaninoff</a>
                </li>
            </ul>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
          <div class="list-wrapper">
            <a href="/posts.html" class="sidebar-nav-item">Posts</a>
            
          </div>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
          <div class="list-wrapper">
            <a href="/tags/" class="sidebar-nav-item">Tags</a>
            
          </div>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
          <div class="list-wrapper">
            <a href="/gallery.html" class="sidebar-nav-item">Gallery</a>
            
          </div>
          
        </li>
      
    
  
    
      
        
        
        <li>
          
          <div class="list-wrapper">
            <a href="/resume/" class="sidebar-nav-item">Resume</a>
            
          </div>
          
        </li>
      
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      




    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/phylosopher07" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      




    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:pianoforte0203@gmail.com" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://facebook.com/100078342350761" title="Facebook" class="no-mark-external">
      <span class="icon-facebook"></span>
      <span class="sr-only">Facebook</span>
    </a>
  </li>


    
  
</ul>

  </div>

  <!--
  <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=http://localhost:4000&count_bg=%23000000&title_bg=%23000000&icon=openstreetmap.svg&icon_color=%23E7E7E7&title=Visitors&edge_flat=false"/>
  -->

</div>

  </header>
</hy-drawer>
<hr class="sr-only" hidden>

</hy-push-state>


  <!--[if gt IE 10]><!---->
<script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}();
</script>
<script src="/assets/js/hydejack-9.1.6.js" type="module"></script>
<script src="/assets/js/LEGACY-hydejack-9.1.6.js" nomodule defer></script>
<script src="/assets/js/sidebar-folder.js"></script>
<script src="/assets/js/clap-button.js"></script>
<script src="/assets/js/katex.js"></script>

  <script src="/assets/js/lightbox.js"></script>


<script type="module">
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";
  let config = {
    startOnLoad: true,
    fontFamily: "JetBrains Mono",
    theme: "neutral"
  };
  mermaid.initialize(config);
  mermaid.run({ querySelector: ".language-mermaid" });
  document
    .getElementById("_pushState")
    .addEventListener("hy-push-state-after", function () {
      mermaid.run({ querySelector: ".language-mermaid" });
    });
</script>

<script>
  document
    .getElementById("_pushState")
    .addEventListener("hy-push-state-load", function () {
      get_clap_count();
      apply_lightbox();
    });
  document
    .getElementById("_pushState")
    .addEventListener("hy-push-state-after", function () {
      render_KaTeX();
    });
</script>


  <script>!function(w, d) {
    w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;

    /**/
      if (navigator.CookiesOK) {
        ga('create', 'G-VMBTN8BX5P', 'auto');
      } else if (d.cookie.indexOf("hy--cookies-ok=true") > -1) {
        ga('create', 'G-VMBTN8BX5P', {
          'storage': 'none',
          'clientId': localStorage ? localStorage.getItem('ga--client-id') : undefined
        });
      } else {
        ga('create', 'G-VMBTN8BX5P', {
          'storage': 'none'
        });
        ga('set', 'forceSSL', true);
        ga('set', 'anonymizeIp', true);
      }
    /**/

    var pushStateEl = d.getElementById('_pushState');
    var timeoutId;
    pushStateEl.addEventListener('hy-push-state-load', function() {
      w.clearTimeout(timeoutId);
      timeoutId = w.setTimeout(function() {
        ga('set', 'page', w.location.pathname);
        ga('send', 'pageview');
      }, 500);
    });

    d.addEventListener('hy--cookies-ok', function () {
      w.ga(function(tracker) {
        w.ga("set", "anonymizeIp", undefined);
        localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId"));
      });
    });

    w.loadJSDeferred('https://www.google-analytics.com/analytics.js');
  }(window, document);</script>


<script type="module">
  if ('serviceWorker' in navigator) {
    /**/
    navigator.serviceWorker.getRegistration()
      .then(r => r.unregister())
      .catch(() => {});
    /**/
  }
</script>
<!--<![endif]-->

  


<div hidden>
  
  <h2 class="sr-only">Templates (for web app):</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <nav id="breadcrumbs" class="screen-only"><ul>
  
  
</ul></nav>

    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

  
    <template id="_cookies-banner-template">
  <div id="_cookies-banner" class="navbar fixed-bottom CookiesOK">
    <div class="content">
      <div class="nav-btn-bar">
        <small class="faded">
          <span>This site uses cookies. <a href="/cookies-policy/">Cookies Policy</a>.
</span>
          <button id="_cookies-ok" class="btn btn-primary btn-sm">Okay</button>
        </small>
      </div>
    </div>
  </div>
</template>

  
  
    <template id="_dark-mode-template">
  <button id="_dark-mode" class="nav-btn no-hover">
    <span class="sr-only">Dark Mode</span>
    <span class="icon-brightness-contrast"></span>
  </button>
</template>

  
  
    <template id="_search-template">
  <button id="_search" class="nav-btn no-hover">
    <label class="sr-only" for="_search-input">Search</label>
    <span class="icon-search"></span>
  </button>
  <div id="_search-box">
    <div class="nav-btn">
      <span class="icon-search"></span>
    </div>
    <input id="_search-input" type="search" class="form-control form-control-lg nav-btn" placeholder="Build with JEKYLL_ENV=production to enable search.">
    <button type="reset" class="nav-btn no-hover">
      <span class="sr-only">Close</span>
      <span class="icon-cross"></span>
    </button>
  </div>
  <div id="_hits"></div>
</template>

  
</div>

<script src="https://static.elfsight.com/platform/platform.js" data-use-service-core defer></script>
<div class="elfsight-app-72805aa7-c85a-4e3d-ac49-24dba36d6185" data-elfsight-app-lazy></div>
</body>
</html>
